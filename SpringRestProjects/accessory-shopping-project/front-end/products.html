<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Aksesuarlar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <div style="width: 30%; margin: auto;">
        <form onsubmit="onSaveProduct(event)">
            <div class="form-group">
                <label for="product-name">Ad</label>
                <input id="product-name" class="form-control">
            </div>
            <div class="form-group">
                <label for="product-description">Detallar</label>
                <input id="product-description" class="form-control">
            </div>
            <input type="submit" value="Yadda Saxla" class="btn btn-success">

        </form>
    </div>
    <hr>
    <div class="container">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Kod</th>
                    <th>Ad</th>
                    <th>Detallar</th>
                </tr>
            </thead>
            <tbody id="products-tbody">

            </tbody>
        </table>
    </div>


    <!--burada sehifenin yenilenmesinin qarsisini aldiq-->
    <script>
        function onSaveProduct(event) {
            event.preventDefault();
            var productName = document.getElementById('product-name').value;
            var productDescription = document.getElementById('product-description').value;

            var productObject = {};
            productObject.name = productName;
            productObject.description = productDescription;

            var http = new XMLHttpRequest();

            http.onload = function () {
                loadAllProducts();
            }

            http.open("POST", "http://localhost:8585/products", true);
            http.setRequestHeader("Content-Type", "application/json");
            http.send(JSON.stringify(productObject));

        }
        function loadAllProducts() {

            var http = new XMLHttpRequest();

            http.onload = function () {
                var response = this.responseText;
                var productsArray = JSON.parse(response);
                fillProductsTable(productsArray);
            }

            http.open("GET", "http://localhost:8585/products", true);
            http.send();
        }
        function fillProductsTable(products) {
            var productsTbodyElement = document.getElementById('products-tbody');

            var productsTbodyHtml = "";
            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                productsTbodyHtml += "<tr><td>" + product.id + "</td>";
                productsTbodyHtml += "<td>" + product.name + "</td>";
                productsTbodyHtml += "<td>" + product.description + "</td>";
                productsTbodyHtml += "<td><button class = 'btn btn-danger'>Sil</button> "
                productsTbodyHtml += "<button class = 'btn btn-primary'>Redakt…ô</button></td></tr>";
            }
            productsTbodyElement.innerHTML = productsTbodyHtml;
        }

        loadAllProducts();
    </script>

</body>

</html>